# ğŸš¨ æ™ºèƒ½å‘Šè­¦åˆ†æç³»ç»Ÿ

ä¸€ä¸ªç°ä»£åŒ–çš„ä¼ä¸šçº§å‘Šè­¦ç®¡ç†å’Œåˆ†æå¹³å°ï¼Œæ”¯æŒå¤šæ•°æ®æºæ¥å…¥ã€å®æ—¶åˆ†æã€æ™ºèƒ½èšåˆå’Œå¯è§†åŒ–å±•ç¤ºã€‚

![License](https://img.shields.io/badge/license-MIT-blue.svg)
![Python](https://img.shields.io/badge/python-3.8+-green.svg)
![FastAPI](https://img.shields.io/badge/FastAPI-0.100+-red.svg)

## âœ¨ ä¸»è¦ç‰¹æ€§

### ğŸ”Œ å¤šæ•°æ®æºæ¥å…¥
- **Prometheus** - ç›‘æ§å‘Šè­¦æ¥å…¥ï¼Œæ”¯æŒAlertManageræ ¼å¼
- **Grafana** - ä»ªè¡¨æ¿å‘Šè­¦ï¼Œæ”¯æŒWebhooké€šçŸ¥
- **Zabbix** - ä¼ ç»Ÿç›‘æ§ç³»ç»Ÿï¼Œå®Œæ•´çš„è§¦å‘å™¨æ”¯æŒ
- **ELK Stack** - æ—¥å¿—å‘Šè­¦ï¼ŒElasticsearchæŸ¥è¯¢å‘Šè­¦
- **è‡ªå®šä¹‰API** - çµæ´»çš„å‘Šè­¦æ¥å…¥ï¼Œæ”¯æŒä»»æ„æ ¼å¼
- **Webhookæ”¯æŒ** - RESTful APIæ¥å£ï¼Œå®‰å…¨ä»¤ç‰Œè®¤è¯

### ğŸ“Š æ™ºèƒ½åˆ†æ
- **å®æ—¶èšåˆ** - å‘Šè­¦æ•°æ®å®æ—¶ç»Ÿè®¡åˆ†æ
- **è¶‹åŠ¿åˆ†æ** - 24å°æ—¶/7å¤©/30å¤©è¶‹åŠ¿å›¾è¡¨
- **å…³è”åˆ†æ** - æ™ºèƒ½è¯†åˆ«å‘Šè­¦å…³è”å…³ç³»
- **ä¸¥é‡ç¨‹åº¦åˆ†å¸ƒ** - å¯è§†åŒ–å‘Šè­¦ä¸¥é‡ç¨‹åº¦
- **TOPç»Ÿè®¡** - æœ€é¢‘ç¹ã€æœ€ä¸¥é‡å‘Šè­¦æ’è¡Œ
- **è‡ªåŠ¨å»é‡** - åŸºäºç›¸ä¼¼åº¦çš„é‡å¤å‘Šè­¦æ£€æµ‹

### ğŸ¯ è§„åˆ™å¼•æ“
- **åˆ†å‘è§„åˆ™** - çµæ´»çš„å‘Šè­¦åˆ†å‘é…ç½®
- **ç”¨æˆ·è®¢é˜…** - ä¸ªæ€§åŒ–å‘Šè­¦è®¢é˜…
- **æ¡ä»¶åŒ¹é…** - æ”¯æŒå¤æ‚çš„é€»è¾‘æ¡ä»¶
- **çŠ¶æ€ç®¡ç†** - å®Œæ•´çš„å‘Šè­¦ç”Ÿå‘½å‘¨æœŸ

### ğŸ–¥ï¸ ç°ä»£åŒ–ç•Œé¢
- **å“åº”å¼è®¾è®¡** - æ”¯æŒæ¡Œé¢å’Œç§»åŠ¨è®¾å¤‡
- **å®æ—¶æ›´æ–°** - WebSocketæ¨é€å®æ—¶æ•°æ®
- **ä¸»é¢˜åˆ‡æ¢** - æ·±è‰²/æµ…è‰²ä¸»é¢˜
- **äº¤äº’å¼å›¾è¡¨** - ä¸°å¯Œçš„æ•°æ®å¯è§†åŒ–
- **ä¼ä¸šçº§UI** - ç°ä»£åŒ–è®¾è®¡é£æ ¼

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Python 3.8+
- FastAPI
- SQLAlchemy
- SQLite/PostgreSQL

### å®‰è£…æ­¥éª¤

1. **å…‹éš†ä»“åº“**
```bash
git clone https://github.com/your-username/alarm-analysis-system.git
cd alarm-analysis-system
```

2. **åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ**
```bash
python3 -m venv venv
source venv/bin/activate  # Linux/Mac
# æˆ– venv\Scripts\activate  # Windows
```

3. **å®‰è£…ä¾èµ–**
```bash
pip install -r requirements.txt
```

4. **åˆå§‹åŒ–æ•°æ®åº“å’Œæ¥å…¥ç‚¹**
```bash
python create_endpoints_and_test.py
```

5. **ç”Ÿæˆç¤ºä¾‹æ•°æ®**
```bash
python simple_chart_data.py
```

6. **å¯åŠ¨æœåŠ¡**
```bash
python main.py
```

7. **è®¿é—®ç³»ç»Ÿ**
- ğŸ  ä¸»é¡µ: http://localhost:8000
- ğŸ“Š ç®¡ç†åå°: http://localhost:8000/admin
- ğŸ“š APIæ–‡æ¡£: http://localhost:8000/docs

### ä¸€é”®æµ‹è¯•
```bash
# æµ‹è¯•æ‰€æœ‰æ¥å…¥ç‚¹åŠŸèƒ½
./test_webhook_endpoints.sh
```

## ğŸ“¡ æ¥å…¥ç‚¹é…ç½®

ç³»ç»Ÿæ”¯æŒå¤šç§ç›‘æ§ç³»ç»Ÿçš„å‘Šè­¦æ¥å…¥ï¼Œæ¯ä¸ªæ¥å…¥ç‚¹éƒ½æœ‰å”¯ä¸€çš„APIä»¤ç‰Œå’ŒURLï¼š

### Prometheus æ¥å…¥ç¤ºä¾‹
```bash
curl -X POST "http://localhost:8000/api/webhook/alarm/{API_TOKEN}" \
  -H "Content-Type: application/json" \
  -d '{
    "alertname": "HighCPUUsage",
    "summary": "CPUä½¿ç”¨ç‡è¿‡é«˜è­¦å‘Š",
    "severity": "critical",
    "instance": "web-server-01:9090",
    "job": "webapp",
    "labels": {
      "env": "production",
      "team": "devops"
    }
  }'
```

### Grafana æ¥å…¥ç¤ºä¾‹
```bash
curl -X POST "http://localhost:8000/api/webhook/alarm/{API_TOKEN}" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "ç£ç›˜ç©ºé—´ä¸è¶³è­¦å‘Š",
    "message": "æœåŠ¡å™¨ç£ç›˜ä½¿ç”¨ç‡è¶…è¿‡85%",
    "state": "alerting",
    "tags": {
      "instance": "db-server-02",
      "service": "database"
    }
  }'
```

### Zabbix æ¥å…¥ç¤ºä¾‹
```bash
curl -X POST "http://localhost:8000/api/webhook/alarm/{API_TOKEN}" \
  -H "Content-Type: application/json" \
  -d '{
    "trigger_name": "å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜",
    "trigger_description": "å†…å­˜ä½¿ç”¨ç‡è¶…è¿‡80%",
    "trigger_severity": "4",
    "host_name": "cache-server-01",
    "item_name": "memory.util"
  }'
```

### æ‰¹é‡å‘Šè­¦æ¥æ”¶
```bash
curl -X POST "http://localhost:8000/api/webhook/batch/{API_TOKEN}" \
  -H "Content-Type: application/json" \
  -d '[
    {
      "alertname": "HighCPUUsage",
      "severity": "critical",
      "instance": "web-01"
    },
    {
      "alertname": "HighMemoryUsage", 
      "severity": "warning",
      "instance": "web-02"
    }
  ]'
```

## ğŸ”§ API æ–‡æ¡£

### å‘Šè­¦ç®¡ç†
```bash
# è·å–å‘Šè­¦åˆ—è¡¨
curl "http://localhost:8000/api/alarms/?status=active&limit=10"

# åˆ›å»ºå‘Šè­¦
curl -X POST "http://localhost:8000/api/alarms/" \
  -H "Content-Type: application/json" \
  -d '{
    "source": "custom",
    "title": "åº”ç”¨æœåŠ¡å¼‚å¸¸",
    "severity": "high",
    "host": "app-server-01"
  }'

# æ›´æ–°å‘Šè­¦çŠ¶æ€
curl -X PUT "http://localhost:8000/api/alarms/1" \
  -H "Content-Type: application/json" \
  -d '{"status": "resolved"}'
```

### åˆ†æç»Ÿè®¡
```bash
# è·å–å‘Šè­¦æ±‡æ€»
curl "http://localhost:8000/api/analytics/summary?time_range=24h"

# è·å–å‘Šè­¦è¶‹åŠ¿
curl "http://localhost:8000/api/analytics/trends?time_range=24h&interval=1h"

# è·å–TOPå‘Šè­¦
curl "http://localhost:8000/api/analytics/top?time_range=24h&limit=10"
```

### æ¥å…¥ç‚¹ç®¡ç†
```bash
# è·å–æ¥å…¥ç‚¹åˆ—è¡¨
curl "http://localhost:8000/api/endpoints/"

# åˆ›å»ºæ¥å…¥ç‚¹
curl -X POST "http://localhost:8000/api/endpoints/" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "prometheus-alerts",
    "endpoint_type": "webhook",
    "description": "Prometheuså‘Šè­¦æ¥å…¥"
  }'

# æµ‹è¯•æ¥å…¥ç‚¹
curl "http://localhost:8000/api/webhook/test/{API_TOKEN}"
```

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç›‘æ§ç³»ç»Ÿ      â”‚    â”‚   å‘Šè­¦ç³»ç»Ÿ      â”‚    â”‚   ç”¨æˆ·ç•Œé¢      â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ Prometheus      â”‚â”€â”€â”€â–¶â”‚ Webhook API     â”‚â”€â”€â”€â–¶â”‚ Web Dashboard   â”‚
â”‚ Grafana         â”‚    â”‚ Rule Engine     â”‚    â”‚ Real-time UI    â”‚
â”‚ Zabbix          â”‚    â”‚ Aggregator      â”‚    â”‚ API Docs        â”‚
â”‚ ELK Stack       â”‚    â”‚ Analyzer        â”‚    â”‚ Mobile Ready    â”‚
â”‚ Custom APIs     â”‚    â”‚ WebSocket       â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
alarm-analysis-system/
â”œâ”€â”€ src/                    # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ api/               # APIè·¯ç”±å’Œç«¯ç‚¹
â”‚   â”‚   â””â”€â”€ routers.py     # ä¸»è¦è·¯ç”±å®šä¹‰
â”‚   â”œâ”€â”€ core/              # æ ¸å¿ƒé…ç½®
â”‚   â”‚   â”œâ”€â”€ config.py      # ç³»ç»Ÿé…ç½®
â”‚   â”‚   â””â”€â”€ database.py    # æ•°æ®åº“é…ç½®
â”‚   â”œâ”€â”€ models/            # æ•°æ®æ¨¡å‹
â”‚   â”‚   â””â”€â”€ alarm.py       # å‘Šè­¦ç›¸å…³æ¨¡å‹
â”‚   â”œâ”€â”€ services/          # ä¸šåŠ¡æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ collector.py   # å‘Šè­¦æ”¶é›†æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ analyzer.py    # æ™ºèƒ½åˆ†ææœåŠ¡
â”‚   â”‚   â”œâ”€â”€ aggregator.py  # èšåˆç»Ÿè®¡æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ endpoint_manager.py  # æ¥å…¥ç‚¹ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ user_manager.py      # ç”¨æˆ·ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ rule_engine.py       # è§„åˆ™å¼•æ“
â”‚   â”‚   â””â”€â”€ websocket_manager.py # WebSocketç®¡ç†
â”‚   â””â”€â”€ utils/             # å·¥å…·å‡½æ•°
â”‚       â””â”€â”€ logger.py      # æ—¥å¿—å·¥å…·
â”œâ”€â”€ static/                # é™æ€èµ„æº
â”‚   â”œâ”€â”€ css/              # æ ·å¼æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ modern.css    # ç°ä»£åŒ–CSSæ¡†æ¶
â”‚   â””â”€â”€ js/               # JavaScriptæ–‡ä»¶
â”‚       â”œâ”€â”€ modern-framework.js  # å‰ç«¯æ¡†æ¶
â”‚       â””â”€â”€ admin-app.js         # ç®¡ç†åº”ç”¨
â”œâ”€â”€ templates/             # HTMLæ¨¡æ¿
â”‚   â””â”€â”€ modern-admin.html  # ç°ä»£åŒ–ç®¡ç†ç•Œé¢
â”œâ”€â”€ main.py               # åº”ç”¨å…¥å£ç‚¹
â”œâ”€â”€ requirements.txt      # Pythonä¾èµ–
â”œâ”€â”€ create_endpoints_and_test.py  # åˆå§‹åŒ–è„šæœ¬
â”œâ”€â”€ simple_chart_data.py          # æ•°æ®ç”Ÿæˆè„šæœ¬
â””â”€â”€ README.md            # é¡¹ç›®æ–‡æ¡£
```

## ğŸ§ª æµ‹è¯•

### è‡ªåŠ¨åŒ–æµ‹è¯•
```bash
# å®Œæ•´åŠŸèƒ½æµ‹è¯•
python complete_test.py

# ç”Ÿæˆå›¾è¡¨æ•°æ®
python simple_chart_data.py

# æµ‹è¯•æ‰€æœ‰æ¥å…¥ç‚¹
./test_webhook_endpoints.sh
```

### æ‰‹åŠ¨æµ‹è¯•
```bash
# åˆ›å»ºæµ‹è¯•æ¥å…¥ç‚¹å’Œç”¨æˆ·
python create_endpoints_and_test.py

# æ£€æŸ¥APIçŠ¶æ€
curl http://localhost:8000/api/alarms/stats/summary

# æŸ¥çœ‹æ¥å…¥ç‚¹
curl http://localhost:8000/api/endpoints/
```

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡
```bash
# æ•°æ®åº“é…ç½®
DATABASE_URL=sqlite:///alarm_system.db

# æœåŠ¡é…ç½®
HOST=0.0.0.0
PORT=8000
DEBUG=True

# Redisé…ç½®ï¼ˆå¯é€‰ï¼‰
REDIS_URL=redis://localhost:6379

# æ—¥å¿—é…ç½®
LOG_LEVEL=INFO
```

### æ¥å…¥ç‚¹é…ç½®
æ¯ä¸ªæ¥å…¥ç‚¹æ”¯æŒä»¥ä¸‹é…ç½®é€‰é¡¹ï¼š
- `field_mapping`: å­—æ®µæ˜ å°„é…ç½®
- `severity_mapping`: ä¸¥é‡ç¨‹åº¦æ˜ å°„
- `default_severity`: é»˜è®¤ä¸¥é‡ç¨‹åº¦
- `rate_limit`: è¯·æ±‚é™æµè®¾ç½®

## ğŸš€ éƒ¨ç½²

### Docker éƒ¨ç½²
```bash
# æ„å»ºé•œåƒ
docker build -t alarm-system .

# è¿è¡Œå®¹å™¨
docker run -p 8000:8000 alarm-system
```

### ç”Ÿäº§ç¯å¢ƒ
```bash
# ä½¿ç”¨ Gunicorn
gunicorn -w 4 -k uvicorn.workers.UvicornWorker main:app

# ä½¿ç”¨ Uvicorn
uvicorn main:app --host 0.0.0.0 --port 8000 --workers 4
```

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. åˆ›å»º Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ™ è‡´è°¢

- [FastAPI](https://fastapi.tiangolo.com/) - ç°ä»£åŒ–çš„Python Webæ¡†æ¶
- [SQLAlchemy](https://www.sqlalchemy.org/) - Python SQLå·¥å…·åŒ…
- [Chart.js](https://www.chartjs.org/) - ä¼˜ç§€çš„å›¾è¡¨åº“

## ğŸ“ è”ç³»

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- æäº¤ [Issue](https://github.com/your-username/alarm-analysis-system/issues)
- å‘é€é‚®ä»¶: your-email@example.com

---

â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™å®ƒä¸€ä¸ªæ˜Ÿæ ‡ï¼